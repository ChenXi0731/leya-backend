# 壓力來源分析功能 - 使用說明

## 功能簡介
壓力來源分析功能會自動分析用戶的聊天記錄和心情日記，使用 AI 識別壓力來源，並以心智圖的方式視覺化呈現。

## 快速開始

### 1. 資料庫設定

首先，在 PostgreSQL 資料庫中執行建表語句：

```bash
psql -U your_username -d leya_talks -f create_emotion_analysis_table.sql
```

或直接在資料庫管理工具中執行 `create_emotion_analysis_table.sql` 的內容。

### 2. 環境變數設定

確保 `.env` 檔案包含 OpenAI API Key：

```env
OPENAI_API_KEY=sk-your-openai-api-key-here
```

### 3. 啟動後端服務

```bash
cd leya-backend
npm install  # 如果尚未安裝依賴
node index.js
```

### 4. 啟動前端開發伺服器

```bash
cd leyatalks.github.io
npm install  # 如果尚未安裝依賴
npm run dev
```

## 使用流程

### 步驟 1: 登入系統
使用現有帳號登入，或註冊新帳號。

### 步驟 2: 建立聊天與心情記錄
1. 前往「聊天頁面」，與 AI 對話記錄您的想法
2. 前往「心情日記」，記錄每日的心情與感受
3. 累積至少 3-5 筆記錄以獲得更準確的分析

### 步驟 3: 執行壓力分析
1. 前往「壓力來源心智圖」頁面
2. 點擊「🔍 AI 壓力分析」按鈕
3. 等待 AI 分析完成（通常需要 10-30 秒）
4. 查看生成的心智圖

### 步驟 4: 查看分析結果
- 心智圖會顯示您的壓力來源分類
- 將滑鼠移到節點上可查看詳細資訊
- 可使用滾輪縮放和拖曳來瀏覽

## 心智圖操作說明

### 視覺元素
- **中心節點（綠色）**: 使用者
- **第一層節點（藍色）**: 壓力來源類型（學業、人際、家庭等）
- **第二層節點（橙色）**: 具體壓力來源，節點大小代表頻率

### 互動操作
- **滑鼠懸停**: 顯示詳細資訊
- **滾輪縮放**: 放大或縮小視圖
- **拖曳**: 移動整個心智圖
- **點擊節點**: 展開或收合（未來功能）

## 分析結果說明

每條分析記錄包含：
- **來源類型 (category)**: 壓力的主要類別
  - 學業：考試、作業、課程等
  - 人際：朋友、同儕、社交等
  - 家庭：家人關係、家庭責任等
  - 財務：經濟壓力、支出等
  - 健康：身體狀況、疲勞等
  - 未來：職涯、人生規劃等

- **來源細項 (source)**: 具體的壓力來源
- **影響面向 (impact)**: 對生活的影響
- **主要感受 (emotion)**: 相關的情緒反應
- **詳細說明 (note)**: AI 的具體分析

## 常見問題 (FAQ)

### Q1: 分析需要多久時間？
A: 通常需要 10-30 秒，取決於您的記錄數量和 OpenAI API 的回應速度。

### Q2: 需要多少記錄才能進行分析？
A: 至少需要 1 筆聊天記錄或心情日記，但建議累積 5 筆以上以獲得更準確的分析。

### Q3: 可以重新分析嗎？
A: 可以！每次點擊「AI 壓力分析」都會基於最新的記錄重新分析。

### Q4: 分析結果會保存嗎？
A: 會！所有分析結果都會保存在資料庫中，您可以隨時查看歷史記錄。

### Q5: 分析結果準確嗎？
A: AI 會根據您的記錄內容進行分析，準確度取決於記錄的詳細程度和數量。這是輔助工具，不能取代專業心理諮詢。

### Q6: 我的資料安全嗎？
A: 是的！您的資料僅儲存在後端資料庫，僅您本人可以查看。OpenAI API 呼叫時會遵守其隱私政策。

### Q7: 如果分析失敗怎麼辦？
A: 請確認：
1. 已登入系統
2. 有足夠的聊天或心情記錄
3. 後端伺服器正常運行
4. OpenAI API Key 設定正確

### Q8: 可以刪除分析記錄嗎？
A: 目前前端尚未實作刪除功能，但後端 API 已支援。未來版本會加入此功能。

## 測試 API

使用提供的測試腳本來驗證 API：

```bash
node test_stress_analysis.js
```

## 技術細節

### 使用的技術
- **前端**: React, D3.js (心智圖視覺化)
- **後端**: Node.js, Express
- **資料庫**: PostgreSQL
- **AI**: OpenAI GPT-4o-mini

### API 端點
- `POST /analyze-stress`: 執行壓力分析
- `GET /emotion-analysis`: 取得分析記錄
- `DELETE /emotion-analysis/:id`: 刪除記錄

詳細 API 文件請參閱 `STRESS_ANALYSIS_API.md`

## 故障排除

### 問題：點擊按鈕沒有反應
**可能原因**: 
1. 未登入
2. 網路連線問題
3. 後端服務未啟動

**解決方案**:
1. 確認已登入
2. 檢查瀏覽器控制台的錯誤訊息
3. 確認後端服務正在運行

### 問題：顯示「該用戶沒有足夠的記錄可供分析」
**解決方案**: 先建立一些聊天記錄或心情日記

### 問題：心智圖顯示不正確
**解決方案**: 
1. 重新整理頁面
2. 清除瀏覽器快取
3. 確認 D3.js 已正確載入

## 聯絡支援

如有問題或建議，請聯繫開發團隊或在 GitHub 提交 Issue。

## 版本紀錄

### v1.0.0 (2025-01-13)
- ✅ 初始版本發布
- ✅ 支援聊天與心情記錄分析
- ✅ AI 驅動的壓力來源識別
- ✅ 心智圖視覺化呈現
- ✅ 完整的 CRUD API
